# Global Crop Yield Analysis
## Team members
- **[Bilal Rizvi](https://github.com/brizvi4)**
- **[Neda Ahmadi J.](https://github.com/NedaAJ)**
- **[Rabab Handa](https://github.com/RababHanda)**
- **[Sohrab Rezaei](https://github.com/SohrabRezaei)**

Deploy : üîú Our Deployment Link will be posted here!

## Selected Topic üåæüåΩ
Agriculture is extremely important to the world economy. Understanding global agricultural output is critical for tackling food security concerns (hunger) as the human population continues to grow.

**Crop yield prediction** is a significant agricultural problem. Agricultural yield is largely influenced by meteorological conditions (rain, temperature, etc.) and pesticides, and reliable information about crop yield history is critical for making agricultural risk management and future predictions choices.

World hunger is now increasing, after having declined for a decade. This trend is expected to last, while being amplified by the alarming population increase. 

We picked top 20 most populated countries of the world to analyze this issue at a macroscopic level and present suggestions that can be implemented to prevent the growing gap between world hunger and crop yield.

Our project consists of three main sections:

- **Prediction** üë©‚Äçüåæüë®üèø‚Äçüåæüìà: We trained our ML model on previous data to predict future total yield of selected crops to help current and new farmers/business owners make an informed decision based on their existing area conditions (rain, temperature, pesticides).
- **Analysis** üå¶Ô∏è: In this section, we want to give the users visual representation of different weather phenomena that would affect their crop yield.
- **Recommendations** üå±: We are trying to advise farmers top three crops to grow in their respective countries (based on each countries' average temperature, rainfall and used pesticide) to maximize total crop yield.  

## Description of the Source Data
We found our datasets for this project on Kaggle: [Crop_Yield_Prediction_Dataset](https://www.kaggle.com/datasets/patelris/crop-yield-prediction-dataset?select=yield.csv)

*All dataset (publicly available dataset) on Kaggle are taken from [FAO (Food and Agriculture Organization)](http://www.fao.org/home/en/) and [World Data Bank](https://data.worldbank.org/).*

## Communication Protocols
We meet once a week in person and go over details fo the project for upcoming weeks. We also communicate regularly via Whatsapp, Slack and do regular Zoom sessions to keep each other informed about the status of our respective aspects of the project. 

Here is a picture of us refueling üòã:
<p align="center">
  <img src="https://github.com/SohrabRezaei/Global-Crop-Yield-Analysis/blob/main/Resources/Visuals/Team_pics/House_on_parlimant.jpeg"
  width="400" 
  height=auto class="rounded">
</p>

And picture of us collaborating *(Don't Judge! It was the Champions League Final ‚öΩ‚öΩ)*: 
<p align="center">
  <img src="https://github.com/SohrabRezaei/Global-Crop-Yield-Analysis/blob/main/Resources/Visuals/Team_pics/Home-1.jpeg"
  width="400" 
  height=auto class="rounded">
</p>
<p align="center"><i>#Play_Hard_Work_Even_Harder</i></p>

## Initial Tools & Technologies
- Creating Database
    - PostgreSQL
    - pgAdmin
    - AWS (RDS-S3)
    - PySpark
- Analyzing Data
    - Jupyter Notebook
    - Pandas
    - Numpy
    - Matplotlib
    - Plotly
    - Seaborn
- Machine Learning
    - Scikit-Learn
      - Random Forest Regressor
      - Gradient Boosting Regressor
      - Linear Regression
      - MLP Regressor
      - Decision Tree Regressor
      - Linear model
      - R2
- Dashboard
    - Javascript
    - D3
    - Flask
    - HTML
    - CSS
    - Leaflet
    - Heroku
    - Boostrap5

## Visualization
***Under Construction üößüößüöß***

We have started building our dashboard as a website containing interactive visualization and forecast generated by our ML model.

You can find the initial plan of our website here:

<p align="center">
  <img src="https://github.com/SohrabRezaei/Global-Crop-Yield-Analysis/blob/main/Resources/Visuals/Deliverable_2/index.PNG">
  <img src="https://github.com/SohrabRezaei/Global-Crop-Yield-Analysis/blob/main/Resources/Visuals/Deliverable_2/yield_prediction.PNG">
  <img src="https://github.com/SohrabRezaei/Global-Crop-Yield-Analysis/blob/main/Resources/Visuals/Deliverable_2/analysis.PNG">
  <img src="https://github.com/SohrabRezaei/Global-Crop-Yield-Analysis/blob/main/Resources/Visuals/Deliverable_2/recommendation.PNG">
</p>

## Machine Learning
Since we are predicting crop yield, we will be using different types of regression models and will choose the best possible model amongst them. So we start by making a correlation matrix. This is done to figure out if there are any two independent variables highly correlated with each other. If any two variables were highly correlated, it would be hard to interpret the results of regression and we would have to eliminate one of the variables. In our first train test split, we set aside the test data. This test data will be used at the very end when we know for sure which model we will use. Then we divide our independent variables into categorical and numerical data, perform One hot encoding on categorical variables and standardize our numerical data. 

The reamining training data will be further split into training and validation data. On validation data, we will tune our hyperparamters for all models and see which model gives us the best results. We apply six different models: LinearRegression(), RandomForestRegressor(), GradientBoostingRegressor(), MLPRegressor(), DecisionTreeRegressor() and LassoRegression. 

After using multiple models and adjusting their parameters, we found out that RandomForestRegressor() gave the best result. Now we are going to apply the Grid Search tenchnique in order to find the best possible parameters for our model. We are going to fit this to our training data which we set aside at the very beginning. From the grid search technique, we find out that in the RandomForestRegressor model, max_depth =10 and n_estimators=300 will give us the best possible model. It did not return other parameters which we passed in our param_grid dictionary as those parameters will not significantly affect our result.

Finally, we our going to incorporate the test data we set aside at the very start. Test data will also be one hot encoded and standardized just like we did with the training data.The r2 score which we get from using y_test and test_prediction iis very similar to the score we got previously.

We can conclude by saying that the model we ended up choosing does a pretty decent job in predicting the crop yield. 


## Database & EDA
You can find our EDA here : [EDA.ipynb](https://github.com/SohrabRezaei/Global-Crop-Yield-Analysis/blob/main/ETL/EDA.ipynb)

We have several primary-composite keys, and the tables have Many-to-Many relationships. All the four tables in our ERD have Country and Year columns, and their data type is varchar and int, respectively. All the tables have a column expressing the table's name, and their data type are int and float. In addition, the yield table has an Item column that represents the crops, and its data type is varchar. After creating the tables in pgadmin, we extracted the CSV files from Amazon S3 by utilizing pyspark. We connected our PostgreSQL to AWS relational database with the aid of JDBC. Finally, we wrote the CSV files into our RDS.

Data Cleaning and ETL files can be found here:  [Data_cleaning.ipynb](https://github.com/SohrabRezaei/Global-Crop-Yield-Analysis/blob/main/ETL/Data_Cleaning.ipynb) | [ETL.ipynb](https://github.com/SohrabRezaei/Global-Crop-Yield-Analysis/blob/main/ETL/ETL.ipynb)

Here you can find the ERD for our database:
<p align="center">
  <img src="https://github.com/SohrabRezaei/Global-Crop-Yield-Analysis/blob/main/Resources/Visuals/Deliverable_2/ERD.jpeg">
</p>



